<script>
    function fnImportarArquivo(input) {
        if (!window.FileReader) return;

        var reader = new FileReader();
        reader.readAsText($("#arquivo")[0].files[0]);
        
        reader.onload = processData;
        reader.onerror = errorHandler;
    }

    function processData(event) {
        fly01.loading.start();
        var ret = event.target.result;

        $.ajax({
            type: "POST",
            url: "@Url.Action("ImportaArquivoRetorno")",
            data: { valueArquivo: ret, contaBancariaId: $('#contaBancariaId').val()},
            success: function (response) {
                if (response.success) {
                    $("#dtRetornoCnabItem").DataTable().destroy();

                    var table = $("#dtRetornoCnabItem").DataTable({
                        bSort: false,
                        paging: false,
                        bLengthChange: false,
                        searching: false,
                        ordering: false,
                        info: false,
                        data: response.data,
                        columns: [
                            { title: "Banco", data: "banco_nome" },
                            { title: "Cliente", data: "pessoa_nome" },
                            { title: "Valor", data: "valorBoleto" },
                            { title: "Data Vencimento", data: "dataVencimento" }]
                    });
                    $('#dtRetornoCnabItem').show();
                } else {
                    fly01.toast(response.message, 'error');
                };
                fly01.loading.stop();
            },
            error: function (jXHR, textStatus, errorThrown) {
                fly01.loading.stop();
                fly01.toast(errorThrown, 'error');
            }
        });
    }

    function errorHandler(evt) {
        if (evt.target.error.name == "NotReadableError") {
            alert("Não foi possível ler o arquivo!");
        }
    }
</script>