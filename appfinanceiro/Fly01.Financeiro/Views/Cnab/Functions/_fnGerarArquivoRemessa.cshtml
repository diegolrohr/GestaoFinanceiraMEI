<script>
    @Html.Partial("Functions/_fnMain");

    function fnGerarArquivoRemessa() {
        $("#dtBoletos").loading("start");
        $.ajax({
            type: "POST",
            url: '@Url.Action("GeraArquivoRemessa","Cnab")',
            data: { ids: fly01._.dtBoletos.selected },
            success: function (retorno) {
                if (retorno.success)
                {
                    retorno.FileGuid.forEach(function(filename) {
                        if (filename != null)
                            window.location = '@Url.Action("DownloadArquivoRemessa", "ArquivoRemessa")?fileName=' + filename;
                        else
                            fly01.toast("Não foi possível baixar o arquivo, tente novamente mais tarde.", 'error');
                    });
                } else {
                    fly01.toast(retorno.message, 'error');
                }

                fly01._.dtBoletos.refresh();
                $("#dtBoletos").loading("stop");
            }
        });
    };
</script>