<script>
    function createBtnExcluirProdutoPendencia(row) {
        var formAttr = {
            "class": "valign-wrapper right col s12 btn btn-narrow valid",
            "id": "btnExcluirProdutoPendencia"+`${row.id}`,
            "onClick": "fnExcluirProdutoPendencia(" + "'" + row.id + "'" + ")",
            "data-tooltip": "Excluir"
        };
        return createElem("a", formAttr, [createElem("i", { "class": "valign-wrapper material-icons center", "style": "margin:0px;position:inherit;background-color:#fafafb00;color:#fafafb;" }, "delete")]);
    }

    function fnRenderExcluirProdutoPendencia(data, type, row, meta) {
        return createBtnExcluirProdutoPendencia(row).outerHTML;
    }

    function fnExcluirProdutoPendencia(idRecord) {
        $$$.confirm("Confirmar Exclusão", "Deseja realmente excluir e ignorar a vinculação?", "fnExcluirProdutoPendenciaConfirmed(\"" + idRecord + "\")");
    }
    function fnExcluirProdutoPendenciaConfirmed(idRecord) {
        $('#dtProdutosPendencias').loading('start');
        if (idRecord) {
            $.ajax({
                type: "POST",
                url: "@Url.Action("Delete", "NFeImportacaoProduto")",
                data: { id: idRecord },
                success: function (data) {
                    if (data.success) {
                        $$$.toast("Excluído com sucesso.", "success");
                        //$(`#btnExcluirProdutoPendencia${idRecord}`).parent().parent().remove();
                        //TODO: Diego ver por que o loading não para..  nem na paginação
                        $$$._.dtProdutosPendencias.ajax.json().recordsTotal -= 1;
                        $$$._.dtProdutosPendencias.refresh();
                        if (!verificaPendencias()) {
                            $('#stepProdutosPendencias').hide();
                            $('li#stepProdutos > div.step-content > div.step-actions > button.btn.previous-step').click();
                        }
                        $('#dtProdutosPendencias').loading('stop');
                    }
                    else {
                        $$$.fn.submitErrorHandler(null, data.message);
                        $('#dtProdutosPendencias').loading('stop');
                    }
                },
                error: function (jXHR, textStatus, errorThrown) {
                    $('#dtProdutosPendencias').loading('stop');
                    $$$.toast(textStatus, "error");
                }
            });
        }
    }
</script>
