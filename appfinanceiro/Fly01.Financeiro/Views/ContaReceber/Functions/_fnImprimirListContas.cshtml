<script>
    @Html.Partial("Functions/_fnImprimir");

    var serialize = function (obj, prefix) {
        var str = [],
            p;
        for (p in obj) {
            if (obj.hasOwnProperty(p)) {
                var k = prefix ? prefix + "[" + p + "]" : p,
                    v = obj[p];
                str.push((v !== null && typeof v === "object") ?
                    serialize(v, k) :
                    encodeURIComponent(k) + "=" + encodeURIComponent(v));
            }
        }
        return str.join("&");
    }

    function validateDate(id) {
        var RegExPattern = /^(0[1-9]|1[0-9]|2[0-9]|3[0-1])\/(0[1-9]|1[0-2])\/([0-9]{4})$/;

        if (!((id.match(RegExPattern)) && (id != '')))
            return true;
        else
            return false;
    }

    function GetListParams() {
        var ListParams = [];
        if ($("#descricao").val() != "") {
            ListParams.push({
                key: "descricao",
                value: $("#descricao").val()
            });
        };

        if ($("#descricaoParcela").val() != "") {
            ListParams.push({
                key: "descricaoParcela",
                value: $("#descricaoParcela").val()
            });
        };

        if ($("#pessoa_nome").val() != "") {
            ListParams.push({
                key: "pessoa/nome",
                value: $("#pessoa_nome").val()
            });
        };

        return ListParams;
    };

    function fnImprimirListContas() {
        var ListParams = GetListParams();
        var queryStringOdata = "";

        if ($("#dataInicial").val() != undefined) {
            let date = fly01._.mesPicker.pickamonth("picker").get("select");
            var firstDay = new Date(date.year, date.month, 1);
            let lastDay = new Date(date.year, date.month + 1, 0);

            var dataInicial = $("#dataInicial").val(moment(firstDay).format('YYYY-MM-DD'));
            var dataFinal = $("#dataFinal").val(moment(lastDay).format('YYYY-MM-DD'));
        }

        var dateParam = $("#dataVencimento").val().split("/").reverse().join("/");
        var newDate = dateParam.replace("/", "-").replace("/", "-");

        for (var list in ListParams) {
            queryStringOdata += "contains(" + ListParams[list].key + ", " + "'" + ListParams[list].value + "'" + ")" + (ListParams[list] != ListParams[ListParams.length - 1] ? " and " : "");
        }

        if (validateDate($("#dataVencimento").val()) && $("#dataVencimento").val() != "") {
            fly01.toast('Data inválida', 'error');
        }
        else {
            var url = "@Url.Action("ImprimirListContas", "ContaPagar")?queryStringOdata=" + queryStringOdata +
                (($("#dataInicial").val() != undefined || dateParam != "") ?
                    (dateParam != undefined && dateParam != "" ?
                        ((queryStringOdata != "") ? " and" : "") + " dataVencimento eq " + newDate :
                        ((queryStringOdata != "") ? " and" : "") + " dataVencimento le " + dataFinal.val() + " and dataVencimento ge " + dataInicial.val())
                                                      : "") +
                ($("#valorPrevisto").val() != "" ? " and valorPrevisto eq " + parseFloat($("#valorPrevisto").val().replace(",", ".")) : "") +
                ($("#numero").val() != "" ? " and numero eq " + $("#numero").val() : "") +
                "&tipoStatus=" + $("#statusContaBancaria").val();


            if (fly01._.fly01dt.ajax.json().data.length > 0)
                fnImprimir(url);
            else
                fly01.toast('Não há dados para imprimir!', 'error');
        }
    }
</script>

