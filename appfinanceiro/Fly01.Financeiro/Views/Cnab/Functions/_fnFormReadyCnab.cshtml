<script>
    @Html.Partial("Functions/_fnMain");

    var arrItems = [];
    var qtdItensSelecionados = 0;

    $().ready(function () {
        $('#btnSendManyMails').attr('disabled', 'disabled');
        $('#btnGerarArqRemessa').attr('disabled', 'disabled');
        setupGridSelectEvents();
        fnSelectRow();
    });

    function fnSelectRow() {
        $$$._.dtBoletos.on("select", function (e, dt, type, indexes) {
            $$$._.dtBoletos.rows(indexes).data().toArray()[0].selected = true;
        }).on('deselect', function (e, dt, type, indexes) {
            $$$._.dtBoletos.rows(indexes).data().toArray()[0].selected = false;
        });
    } 

    function setupGridSelectEvents() {
        $$$._.dtBoletos.on("select", function (e, dt, type, indexes) {
            let indice = parseInt(indexes.toString());

            if ($$$._.dtBoletos.rows().data()[indice].statusDescription !== "BAIXADO") {
                if (type !== undefined) {
                    indexes.forEach(function (element, index, array) {
                        fnAtualizaCountSelecionados(1);
                    });
                }
            }
            else {
                $($$$._.dtBoletos.rows().$("tr")[indice]).removeClass('selected');
            }
        }).on('deselect', function (e, dt, type, indexes) {
            if (type !== undefined) {
                indexes.forEach(function (element, index, array) {
                    fnAtualizaCountSelecionados(-1);
                });
            }
        });
    }

    function fnAtualizaCountSelecionados(count) {
        var countAtual = qtdItensSelecionados;
        countAtual = countAtual + (parseInt(count));
        qtdItensSelecionados = countAtual;

        $$$.fn.updateTextFields();
        $('#btnGerarArqRemessa').attr('disabled', 'disabled');
        $('#btnSendManyMails').attr('disabled', 'disabled');
        
        if (countAtual > 0 && countAtual <= 50) {
            $('#btnGerarArqRemessa').removeAttr('disabled');
            $('#btnSendManyMails').removeAttr('disabled');
        }
        else if (countAtual <= 0) {
            $('#btnGerarArqRemessa').attr('disabled', 'disabled');
            $('#btnSendManyMails').attr('disabled', 'disabled');
        }
        else {
            $('#btnGerarArqRemessa').attr('disabled', 'disabled');
            $('#btnSendManyMails').attr('disabled', 'disabled');
        }
    }
</script>