<script>
    @Html.Partial("Functions/_fnMain");

    function setupGridSelectEvents() {
        //ver validacao contador limite de 50
        fly01._.dtContasExistentes.on("select", function (e, dt, type, indexes) {
            if (type !== undefined) {
                var valorAcumulado = getValorSomaSelecionados();
                var rowData = fly01._.dtContasExistentes.rows(indexes).data().toArray();
                var valorSaldo = parseFloat(rowData[0].saldo.replace("R$ ", "").replace("R$", "").replace(".", "").replace(",", "."));
                valorAcumulado += valorSaldo;
                $('input#somaValoresSelecionados').val(valorAcumulado);
                //data.total.TotalProdutos.formatMoneyMask(2, 3, '', ','));
                fnAtualizaCountSelecionados(1);
                $('input#contasFinanceirasGuids').val(fly01._.dtContasExistentes.selected);
            }
        }).on('deselect', function (e, dt, type, indexes) {
            if (type !== undefined) {
                var valorAcumulado = getValorSomaSelecionados();
                var rowData = fly01._.dtContasExistentes.rows(indexes).data().toArray();
                var valorSaldo = parseFloat(rowData[0].saldo.replace("R$ ", "").replace("R$", "").replace(".", "").replace(",", "."));

                valorAcumulado -= valorSaldo;
                $('input#somaValoresSelecionados').val(valorAcumulado);
                fnAtualizaCountSelecionados(-1);
                $('input#contasFinanceirasGuids').val(fly01._.dtContasExistentes.selected);
            }
        });
    }

    function getValorSomaSelecionados() {
        var somaValores = $('#somaValoresSelecionados').val().replace("R$", "").replace("R$ ", "").replace(".", "").replace(",", ".");
        var result = parseFloat(somaValores);
        return result;
    }

    function fnAtualizaCountSelecionados(count) {
        var countAtual = parseInt($('input#countContasSelecionadas').val());
        countAtual = countAtual + (parseInt(count));
        $('input#countContasSelecionadas').val(countAtual);

        fly01.core.updateTextFields();
        $('input#countContasSelecionadas').css('color', '');
        $('#save').attr('disabled', 'disabled');

        if (countAtual > 0 && countAtual <= 5) {
            $('input#countContasSelecionadas').css('color', 'green');
            $('#save').removeAttr('disabled');
        }
        else if (countAtual <= 0) {
            $('#countContasSelecionadas').css('color', 'red');
            $('#save').attr('disabled', 'disabled');
        }
        else {
            $('#countContasSelecionadas').css('color', 'red');
            fly01.toast('A quantidade de contas selecionadas é de até 50.', "error");
            $('#save').attr('disabled', 'disabled');
        }
    }

    function fnFormReadyBaixaMultipla() {
        $('#Field').hide();
        setupGridSelectEvents();
    }
</script>