<script>
    function fnChangeProduto() {
        var produtoId = $("#produtoId").val();
        if (produtoId == "") return;

        loadingDadosProduto("start");
        $.ajax({
                url: '@Url.Action("Json", "Produto")',
                type: "GET",
                data: { id: $("#produtoId").val() }
            })
            .done(function (data) {
                fnAtualizaDadosProduto(data.codigoProduto,
                                       data.codigoBarras,
                                       data.saldoProduto);
                loadingDadosProduto("stop");
            })
            .fail(function (jqxhr, textStatus, error) {
                loadingDadosProduto("stop");
                var err = 'Ocorreu um erro na requisição: ' + textStatus + ", " + error;
                $$$.toast(err, "error");
                $('body').addClass('loaded');
        });
    }

    function fnAtualizaDadosProduto(codigoProduto, codigoBarras, saldoProduto)
    {
        $("#codigoProduto").val(codigoProduto);
        $("#codigoBarras").val(codigoBarras);
        $("#saldoProduto").val(saldoProduto);
        $$$.fn.updateTextFields();

        fnChangeQuantidade();
    }

    function loadingDadosProduto(action) {
        $("#codigoProduto").loading(action);
        $("#codigoBarras").loading(action);
        $("#saldoProduto").loading(action);
        $("#novoEstoque").loading(action);
    }
</script>