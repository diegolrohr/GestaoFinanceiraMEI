<script>
    @Html.Partial("Functions/_fnMain");
    var arrItems = [];
    var qtdItensSelecionados = 0;

    $().ready(function () {
        $('#baixarTodosXmls').hide();
        $('#baixarXmls').hide();
        setupGridSelectEvents();
        fnSelectRow();
        fnChangeDate();
    });

    function fnChangeDate() {
        $('#data').change(function () {
            if ($('#data').val() !== "") {
                $('#baixarXmls').show();
            }
        });
    }

    function setupGridSelectEvents() {

        $$$._.fly01dt.on("select", function (e, dt, type, indexes) {
            let indice = parseInt(indexes.toString());

            if ($$$._.fly01dt.rows().data()[indice].statusDescription !== "Não Transmitida") {
                if (type !== undefined) {
                    indexes.forEach(function (element, index, array) {
                        fnAtualizaCountSelecionados(1);
                    });
                }
            }
            else {
                $($$$._.fly01dt.rows().$("tr")[indice]).removeClass('selected');
                $($$$._.fly01dt.selected.splice(indice, 1));
            }

        }).on('deselect', function (e, dt, type, indexes) {
            if (type !== undefined) {
                indexes.forEach(function (element, index, array) {
                    fnAtualizaCountSelecionados(-1);
                });
            }
        });
    }

    function fnSelectRow() {
        $$$._.fly01dt.on("select", function (e, dt, type, indexes) {
            $$$._.fly01dt.rows(indexes).data().toArray()[0].selected = true;
        }).on('deselect', function (e, dt, type, indexes) {
            $$$._.fly01dt.rows(indexes).data().toArray()[0].selected = false;
        });
    }

    function fnAtualizaCountSelecionados(count) {
        var countAtual = qtdItensSelecionados;
        countAtual = countAtual + (parseInt(count));
        qtdItensSelecionados = countAtual;

        if (countAtual >= 2)
            $('#baixarTodosXmls').show();
        else
            $('#baixarTodosXmls').hide();

    }
</script>