<script>
    @Html.Partial("Functions/_fnMain");

    function listProdutos() {
        var t = $('#fly01mdlfrmVisualizarImportacao #id').val();
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetNFeImportacaoProdutos", "NFeImportacaoProduto")?id=' + t ,
            dataType: "json",
            contentType: "application/json",
            success: function (response) {
                if (response) {
                    $("#produtosImportacaoDataTable").DataTable().destroy();

                    var table = $("#produtosImportacaoDataTable").DataTable({
                        bSort: false,
                        paging: false,
                        bLengthChange: false,
                        searching: false,
                        ordering: false,
                        info: false,
                        data: response.data,
                        columns: [
                            { title: "Produto", data: "descricao" },
                            { title: "Quant.", data: "quantidade" },
                            { title: "Un.", data: "unidadeMedida_abreviacao" },
                            { title: "Valor", data: "valor" },
                            { title: "Valor Venda", data: "valorVenda" },
                            { title: "Mov. Estoque", data: "movimentaEstoque" },
                            { title: "At. Produto", data: "atualizaDadosProduto" },
                            { title: "At. Valor Venda", data: "atualizaValorVenda" }
                        ]
                    });
                    fixFields();
                } else {
                    $$$.toast(response.message, 'error');
                }
            },
            error: function (jXHR, textStatus, errorThrown) {
                $$$.toast(errorThrown, 'error');
            }
        });
    }

    function fnFormReadyVisualizarImportacao() {
        listProdutos();
    }

    function fixFields() {
        for (var i = 0; i < $("#produtosImportacaoDataTable td").length; i++) {
            if ($("#produtosImportacaoDataTable td")[i].innerText == "true")
                $("#produtosImportacaoDataTable td")[i].innerText = "Sim"
            else if ($("#produtosImportacaoDataTable td")[i].innerText == "false")
                $("#produtosImportacaoDataTable td")[i].innerText = "Não"
        }
    }
</script>