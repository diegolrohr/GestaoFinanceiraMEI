<script>
    function createElementExcluirProdutoResolvido(row) {
        var formAttr = {
            "class": "valign-wrapper right col s12 btn btn-narrow valid",
            "id": "btnExcluirResolvidos" +`${row.id}`,
            "onClick": "fnExcluirProduto(" + "'" + row.id + "'" + ")",
            "data-tooltip": "Excluir"
        };
        return createElem("a", formAttr, [createElem("i", { "class": "valign-wrapper material-icons center", "style": "margin:0px;position:inherit;background-color:#fafafb00;color:#fafafb;" }, "delete")]);
    }

    function fnRenderButtonExcluirProdutos(data, type, row, meta) {
        return createElementExcluirProdutoResolvido(row).outerHTML;
    }

    function fnExcluirProduto(idRecord) {
        $$$.confirm("Confirmar Exclusão", "Deseja realmente excluir este produto?", "fnExcluirProdutoConfirmed(\"" + idRecord + "\")");
    }

    function fnExcluirProdutoConfirmed(idRecord) {
        $('#dtProdutosResolvidos').loading('start');
        if (idRecord) {
            $.ajax({
                type: "POST",
                url: "@Url.Action("Delete", "NFeImportacaoProduto")",
                data: { id: idRecord },
                success: function (data) {
                    $('#dtProdutosResolvidos').loading('stop');
                    if (data.success) {
                        $$$.toast("Excluído com sucesso.", "success");
                        $(`#btnExcluirResolvidos${idRecord}`).parent().parent().remove();
                    }
                    else {
                        $$$.fn.submitErrorHandler(null, data.message);
                    }
                },
                error: function (jXHR, textStatus, errorThrown) {
                    $('#dtProdutosResolvidos').loading('stop');
                    $$$.toast(textStatus, "error");
                }
            });
        }
    }
</script>
