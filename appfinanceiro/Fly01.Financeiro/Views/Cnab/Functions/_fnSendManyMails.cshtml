<script>
    @Html.Partial("Functions/_fnMain");

    function fnSendManyMails() {
        var differentEmails = false;
        var emailBase = "";
        var idContaBanca = "";

        $$$._.dtBoletos.context[0].json.data.forEach(function (item) {
            if (item.selected) {
                if (emailBase === "") {
                    emailBase = item.contaReceber_pessoa_email;
                    idContaBanca = item.contaBancariaId;
                }

                if (emailBase !== item.contaReceber_pessoa_email) {
                    differentEmails = true;
                    return false;
                }
            }
        });

        if (!differentEmails) {
            
            $("#dtBoletos").loading("start");
            $.ajax({
                type: "POST",
                url: '@Url.Action("ModalConfigEmail", "Cnab")',
                data: { email: emailBase, contaBancariaId: idContaBanca },
                success: function (retorno) {
                    if (retorno !== null) {
                        $$$.modal(retorno);
                        $(".selected").removeClass("selected");
                    }

                    setTimeout(function () {
                        $$$._.dtBoletos.refresh();
                        $("#dtBoletos").loading("stop");
                    }, 5000);
                }
            });
        } else {
            $$$.toast("Não é possível enviar múltiplos e-mails para destinatários diferentes.", "info");
        }
    }
</script>