<script>
    function fnBaixarContas() {
        var contasTObaixa = [];
        var boletos = [];

        table = $('#dtRetornoCnabItem').DataTable();
        table.rows({ selected: true }).data().each(function (row) {
            contasTObaixa.push(row.contaReceberId);
            boletos.push(row.id);
        });

        $$$.loading.start();
        $.ajax({
            type: "POST",
            url: "@Url.Action("BaixarContasReceber","ArquivoRetorno")",
            data: { IdBoletos: boletos, IdToBaixa: contasTObaixa, contaBancariaId: table.rows().data()[0].contaBancariaId },
            success: function (response) {
                if (response.success) {
                    $$$.toast(response.message, "success");
                    $$$.loading.stop();
                    fnImportarArquivo();
                } else {
                    try {
                        var jsonMessage = JSON.parse(response.message);

                        jsonMessage.innerMessage.filter(x => ((x.dataField || "") == "")).forEach(element => {
                            $$$.toast(element.message, "error", 8000);
                        });
                    } catch (e) {
                        $$$.toast(response.message, "error");
                    }
                }
            },
            error: function (jXHR, textStatus, errorThrown) {
                $$$.loading.stop();
                $$$.toast(errorThrown, 'error');
            }
        });
        $$$.loading.stop();
    }
</script>