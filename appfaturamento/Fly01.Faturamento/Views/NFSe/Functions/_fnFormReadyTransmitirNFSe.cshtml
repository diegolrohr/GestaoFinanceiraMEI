<script>
    @Html.Partial("Functions/_fnMain");

    function noComma(e) {
        return e.replace(',', '.');
    }

    function calculaTotalNFSeTransmitir() {
        var valorFrete = 0;
        if ($('input#tipoFreteNFSe').val() == "CIF" || $('input#tipoFreteNFSe').val() == "Remetente") {
            valorFrete = parseFloat(noComma($('form#fly01mdlfrmTransmitirNFSe input#valorFreteNFSe').val()));
        }

        var idNFSe = $("form#fly01mdlfrmTransmitirNFSe input#idNFSe").val();
        fly01.loading.start();

        $.ajax({
            url: '@Url.Action("TotalNotaFiscal", "NotaFiscal")',
            type: "GET",
            data: { id: idNFSe, valorFreteCIF: valorFrete }
        })
        .done(function (data) {
            if (data.success) {
                $('input#totalServicos').val(data.total.TotalServicos.formatMoneyMask(2, 3, '', ','));
                $('input#totalImpostosServicos').val(data.total.TotalImpostosServicos.formatMoneyMask(2, 3, '', ','));
                $('form#fly01mdlfrmTransmitirNFSe input#totalFreteNFSe').val(data.total.ValorFreteCIF.formatMoneyMask(2, 3, '', ','));
                $('form#fly01mdlfrmTransmitirNFSe input#totalNotaFiscalNFSe').val(data.total.Total.formatMoneyMask(2, 3, '', ','));
                fly01.fn.updateTextFields();
            }
            else {
                fly01.fn.submitErrorHandler(null, data.message);
            }
            fly01.loading.stop();
        })
        .fail(function (jqxhr, textStatus, error) {
            var err = 'Ocorreu um erro na requisição: ' + textStatus + ", " + error;
            fly01.toast(err, "error");
            fly01.loading.stop();
        });
    }

    function fnFormReadyTransmitirNFSe() {
        calculaTotalNFSeTransmitir();
    }
</script>