<script>
    function fnChangeTipoFatorConversao(tipo) {
        $('form#fly01mdlfrmFatorConversao #tipoFatorConversao').val(tipo);
        calculaFatorConversao(tipo);
    }

    function validaQuantidadeValorFinal(quantFinal, valorFinal) {
        if (quantFinal <= 0.0 || valorFinal <= 0.0) {
            $$$.toast("Quantidade e/ou valor unitário convertido, devem ser superior a zero. Altere o fator de conversão.", 'error');
        }
    }

    function calculaFatorConversao(tipo) {
        var quant = parseFloat(noComma($('form#fly01mdlfrmFatorConversao #quantidadeXml').val()));
        var valor = parseFloat(noComma($('form#fly01mdlfrmFatorConversao #valorXml').val()));
        var fator = parseFloat(noComma($('form#fly01mdlfrmFatorConversao #fatorConversao').val()));
        var totalXml = quant * valor;
        if (fator <= 0.0) {
            $$$.toast("Fator de conversão deve ser superior a zero.", 'error');
            $('form#fly01mdlfrmFatorConversao #fatorConversao').val(1.00);
        }

        if (tipo == "Multiplicar") {
            var quantFinal = parseFloat((quant * fator).toFixed(2));
            var valorFinal = parseFloat((valor / fator).toFixed(2));
            $('form#fly01mdlfrmFatorConversao #quantidadeConvertida').val(quantFinal);
            $('form#fly01mdlfrmFatorConversao #valorConvertido').val(valorFinal);
            validaQuantidadeValorFinal(quantFinal, valorFinal);
        }
        else {
            var quantFinal = parseFloat((quant / fator).toFixed(2));
            var valorFinal = parseFloat((valor * fator).toFixed(2));
            $('form#fly01mdlfrmFatorConversao #quantidadeConvertida').val(quantFinal);
            $('form#fly01mdlfrmFatorConversao #valorConvertido').val(valorFinal);
            validaQuantidadeValorFinal(quantFinal, valorFinal);
        }
        $$$.fn.updateTextFields();
    }
</script>