<script>
    function fnBuscaCEP(d) {
        var cep = $(this).val();

        if (cep.length == 8) {
            fnLoadingCamposEndereco("start");

            $.ajax({
                type: "GET",
                url: "@Url.Action("BuscaCEP")?cep=" + cep,
                success: function (data) {
                    if (data.success) {
                        var endereco = data.endereco;

                        fnFillAddressFields(endereco.State,
                            endereco.StateId,
                            endereco.City,
                            endereco.CityId,
                            endereco.Neighborhood,
                            endereco.Address,
                            endereco.StateCodeIbge,
                            endereco.CityCodeIbge);
                    }
                    else {
                        fnFillAddressFields("", "", "", "", "", "", "", "");
                    }

                    fnLoadingCamposEndereco("stop");
                    $$$.fn.updateTextFields();
                }
            });
        }
    }

    function fnFillAddressFields(State, StateId, City, CityId, Neighborhood, Address, StateCodeIbge, CityCodeIbge) {
        $("#estadoNome").val(State);
        $("#estadoId").val(StateId);
        $("#cidadeNome").val(City);
        $("#cidadeId").val(CityId);
        $("#bairro").val(Neighborhood);
        $("#endereco").val(Address);
        $("#estadoCodigoIbge").val(StateCodeIbge);
        $("#cidadeCodigoIbge").val(CityCodeIbge);
        $("#numero").val("");
    }

    function fnLoadingCamposEndereco(evento) {
        $("#cep").loading(evento);
        $("#estadoNome").loading(evento);
        $("#cidadeNome").loading(evento);
        $("#bairro").loading(evento);
        $("#endereco").loading(evento);
    }
</script>