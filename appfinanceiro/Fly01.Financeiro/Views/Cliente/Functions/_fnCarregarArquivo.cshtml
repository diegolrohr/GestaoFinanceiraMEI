<script>
    function fnCarregarArquivo(input) {
        if (!window.FileReader) return; // Browser is not compatible

        var reader = new FileReader();
        // Read file into memory as UTF-8
        reader.readAsText($("#arquivo")[0].files[0]);
        var nome = ($("#arquivo")[0].files[0].type)
        // Handle errors load
        if (nome == "application/vnd.ms-excel") {
            reader.onload = processData;
            reader.onerror = errorHandler;
        }
        else
            $$$.toast("Não foi possível ler o arquivo!", "error");
    }

    function processData(event) {
        $('body').removeClass('loaded');
        var csv = event.target.result;

        $.ajax({
            type: "POST",
            url: "@Url.Action("ImportaArquivo")",
            data: { conteudo: csv },
            success: function (response) {
                if (response.message == null) {
                    $("#observacao").closest("div").css("display", "block");
                    $("#observacao").val(response.Retorno);
                    $("#observacao").trigger("autoresize");
                    $$$.fn.updateTextFields();
                    $('body').addClass('loaded');
                }
                else {
                    $$$.toast(response.message, 'error');
                    $('body').addClass('loaded');
                }
            },     
        });
    }

    function errorHandler(evt) {
        if (evt.target.error.name == "NotReadableError") {
            alert("Não foi possível ler o arquivo!");
        }
    }
</script>