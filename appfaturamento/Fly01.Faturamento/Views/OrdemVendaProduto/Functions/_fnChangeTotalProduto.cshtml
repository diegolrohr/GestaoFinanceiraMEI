<script>
    function noComma(e) {
        return e.replace(',', '.');
    }

    function handleNegativeValuesProduto() {
        var formOrdemVenda = 'form#fly01mdlfrmOrdemVendaProduto ';

        if (parseFloat($(formOrdemVenda + 'input#valor').val()) < 0) {
            $(formOrdemVenda + 'input#valor').val(function () { return (parseFloat(noComma(this.value)) * -1) });
        }
        if (parseFloat($(formOrdemVenda + 'input#quantidade').val()) < 0) {
            $(formOrdemVenda + 'input#quantidade').val(function () { return (parseFloat(noComma(this.value)) * -1) });
        }
        if (parseFloat($(formOrdemVenda + 'input#desconto').val()) < 0) {
            $(formOrdemVenda + 'input#desconto').val(function () { return (parseInt(noComma(this.value)) * -1) });
        }
    }

    function errTotalNegativoProduto(total) {
        var formOrdemVenda = 'form#fly01mdlfrmOrdemVendaProduto ';

        $$$.fn.submitErrorHandler($formOrdemVenda.validate(), "{\"innerMessage\": [{\"dataField\":\"input#desconto\",\"message\":\"O desconto não pode ser maior ou igual a R$ " + total + "\"}]}");

        $(formOrdemVenda + 'input#total').val(total);
        $(formOrdemVenda + 'input#desconto').val("");

        return false;
    }

    function fnChangeTotalProduto() {
        handleNegativeValuesProduto();

        var formOrdemVenda = 'form#fly01mdlfrmOrdemVendaProduto ';

        var valor = noComma($(formOrdemVenda + 'input#valor').val()), quantidade = noComma($(formOrdemVenda + 'input#quantidade').val()), desconto = noComma($(formOrdemVenda + 'input#desconto').val());

        if ((!valor) || (!quantidade)) {
            $(formOrdemVenda + 'input#total').val("");
            return;
        }

        var total = (parseFloat(quantidade) * parseFloat(valor));

        ////para nota de complemento de quantidade,ou seja, nao foi informado quantidade, apenas valor.
        //if (total <= 0 && valor > 0) {
        //    total == valor
        //}
        var totalDescontado = total - (!desconto ? 0 : parseFloat(desconto));

        if (totalDescontado >= 0) {
            totalDescontado = totalDescontado.formatMoneyMask(2, 3, '', ',');
            $(formOrdemVenda + 'input#total').val(totalDescontado);
        }
        else {
            total = total.formatMoneyMask(2, 3, '', ',');
            errTotalNegativoProduto(total);
        }
    }
</script>