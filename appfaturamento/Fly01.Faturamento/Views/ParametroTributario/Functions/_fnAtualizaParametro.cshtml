<script>
    function fnAtualizaParametro() {
        $$$.loading.start();

        if ($("#aliquotaSimplesNacional").val() == "" || $("#aliquotaSimplesNacional").val() == null) {
            $("#aliquotaSimplesNacional").val("0");
        }

        if ($("#aliquotaISS").val() == "" || $("#aliquotaISS").val() == null) {
            $("#aliquotaISS").val("0");
        }

        if ($("#aliquotaPISPASEP").val() == "" || $("#aliquotaPISPASEP").val() == null) {
            $("#aliquotaPISPASEP").val("0");
        }

        if ($("#aliquotaCOFINS").val() == "" || $("#aliquotaCOFINS").val() == null) {
            $("#aliquotaCOFINS").val("0");
        }

        if ($("#aliquotaFCP").val() == "" || $("#aliquotaFCP").val() == null) {
            $("#aliquotaFCP").val("0");
        }

        if ($("#aliquotaCSLL").val() == "" || $("#aliquotaCSLL").val() == null) {
            $("#aliquotaCSLL").val("0");
        }

        if ($("#aliquotaINSS").val() == "" || $("#aliquotaINSS").val() == null) {
            $("#aliquotaINSS").val("0");
        }

        if ($("#aliquotaImpostoRenda").val() == "" || $("#aliquotaImpostoRenda").val() == null) {
            $("#aliquotaImpostoRenda").val("0");
        }

        $.ajax({
            url: '@Url.Action("ValidaDadosEmpresa", "ParametroTributario")',
            type: "POST",
            data: {
            },
            success: function (response) {
                if (response.success) {
                    ImportaParametro();
                }
                else {
                    $$$.loading.stop();
                    var url = "@Url.Action("ModalAtualizaIE", "ParametroTributario")";
                    $$$.modal(url);
                }
                
            },
        });
    }

    function ImportaParametro() {
        $.ajax({
            url: '@Url.Action("ImportaParametro", "ParametroTributario")',
            type: "POST",
            data: {
                id: $('#id').val(),
                mensagem: $('#mensagemPadraoNota').val(),
                simplesnacional: $("#aliquotaSimplesNacional").val(),
                fcp: $("#aliquotaFCP").val(),
                iss: $("#aliquotaISS").val(),
                pispasep: $("#aliquotaPISPASEP").val(),
                cofins: $("#aliquotaCOFINS").val(),
                numeroRetorno: $("#numeroRetornoNF").val(),
                modalidade: $('#tipoModalidade').val(),
                versao: $('#tipoVersaoNFe').val(),
                ambiente: $('#tipoAmbiente').val(),
                tipoPresencaComprador: $('#tipoPresencaComprador').val(),
                horarioVerao: $('#horarioVerao').val(),
                tipoHorario: $('#tipoHorario').val(),
                versaoNFSe: $('#versaoNFSe').val(),
                usuarioWebServer: $('#usuarioWebServer').val(),
                senhaWebServer: $('#senhaWebServer').val(),
                chaveAutenticacao: $('#chaveAutenticacao').val(),
                autorizacao: $('#autorizacao').val(),
                tipoTributacaoNFS: $('#tipoTributacaoNFS').val(),
                tipoAmbienteNFS: $('#tipoAmbienteNFS').val(),
                csll: $("#aliquotaCSLL").val(),
                inss: $("#aliquotaINSS").val(),
                impostoRenda: $("#aliquotaImpostoRenda").val(),
                incentivoCultura: $("input#incentivoCultura").prop("checked"),
                formatarCodigoISS: $("input#formatarCodigoISS").prop("checked"),
                tipoRegimeEspecialTributacao: $('#tipoRegimeEspecialTributacao').val(),
                tipoCRT: $('#tipoCRT').val()
            },
            success: function (response) {
                if (response.success) {
                    $('#id').val(response.id);
                    $$$.fn.updateTextFields();
                    $$$.toast("Parâmetros Atualizados", 'success', '4000');
                }
                else {
                    $$$.fn.submitErrorHandler($('#fly01frm').validate(), response.message, 'error');
                }
                $$$.loading.stop();
            },
        });
    }
</script>