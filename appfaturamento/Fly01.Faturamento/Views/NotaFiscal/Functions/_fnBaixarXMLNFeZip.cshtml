<script>
    function fnBaixarXMLNFeZip() {
        @*$("#fly01dt").loading("start");
        window.location = '@Url.Action("BaixarXMLs", "NFe")?idsXML=' + $$$._.fly01dt.selected.toString();
        $("#fly01dt").loading("stop");*@

        $$$.loading.start();
        $.ajax({
            url: '@Url.Action("BaixarXMLs", "NFe")?idsXML=' + $$$._.fly01dt.selected.toString(),
            type: "GET"
        })
        .done(function (data) {
            $$$.loading.stop();
            if (data.message) {
                $$$.fn.submitErrorHandler(null, data.message);
            } else {
                location.href = data.downloadAddress;
            }
        })
        .fail(function (jqxhr, textStatus, error) {
            var err = 'Ocorreu um erro na requisição: ' + textStatus + ", " + error;
            $$$.toast(err, "error");
            $$$.loading.stop();
        });
    }
</script>