<script>
    function fnSimulaParcelamento() {
        if ($("#TipoSimulacao").val() === "QtdParcelas" && $("#qtdParcelas").val() === "") {
            $$$.toast("Quantidade de Parcelas não informadas", 'error');
            return false;
        }

        if ($("#TipoSimulacao").val() === "CondParcelamento" && $("#condicoesParcelamento").val() === "") {
            $$$.toast("Intervalo de dias não informado", 'error');
            return false;
        }

        if (parseFloat($("#valorReferencia").val()) <= 0) {
            $$$.toast("Valor referência deve ser maior que R$ 1,00", 'error');
            return false;
        }

        if ($("#valorReferencia").val() == "") {
            $$$.toast("Valor referência não informado", 'error');
            return false;
        }

        if ($("#dataReferencia").val() == "") {
            $$$.toast("Data Referência não informada", 'error');
            return false;
        }
        if ($("#dataReferencia").val().length < "8") {
            $$$.toast("Data Referência inválida.", 'error');
            return false;
        }


        var dataRow = {
            valorPrevisto: $("#valorReferencia").val(),
            dataVencimento: $("#dataReferencia").val(),
            condicoesParcelamento: $("#condicoesParcelamento").val(),
            qtdParcelas: $("#qtdParcelas").val()
        }

        $.ajax({
            type: "POST",
            url: "@Url.Action("GridLoadSimulacao", "CondicaoParcelamento")",
            dataType: "json",
            contentType: "application/json",
            data: JSON.stringify(dataRow),
            success: function (response) {
                if (response.success) {
                    $("#simulatorDataTable").DataTable().destroy();

                    var table = $("#simulatorDataTable").DataTable({
                        bSort: false,
                        paging: false,
                        bLengthChange: false,
                        searching: false,
                        ordering: false,
                        info: false,
                        data: response.data,
                        columns: [
                            { title: "Parcela", data: "descricaoParcela" },
                            { title: "Data", data: "dataVencimentoString" },
                            { title: "Valor", data: "valor" }]
                    });
                } else {
                    $$$.toast(response.message, 'error');
                }
            },
            error: function (jXHR, textStatus, errorThrown) {
                $$$.toast(errorThrown, 'error');
            }
        });
    }
</script>