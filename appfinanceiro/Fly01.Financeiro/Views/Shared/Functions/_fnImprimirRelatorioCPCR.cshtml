
<script>
    @Html.Partial("Functions/_fnImprimir");
    function fnImprimirRelatorioCPCR() {

        var countValues = 0;
        var valueItens = [$('input#dataEmissaoInicial').val(), $('input#dataEmissaoFinal').val(), $('input#dataInicial').val(), $('input#dataFinal').val(), $("#clienteId").val(), $("#formaPagamentoId").val(), $("#condicaoParcelamentoId").val(), $("#categoriaId").val(), $('#descricao').val()];
        valueItens.forEach(function (item) {
            if (item !== "") {
                countValues ++;
                return false;
            }
        });

        if (countValues === 0)
            $$$.toast("Inform ao menos um parâmetro para continuar.", 'error');
        else {
            var dataEmissaoInicialDisplay = moment($('input#dataEmissaoInicial').val(), "DD/MM/YYYY");
            var dataEmissaoInicial = moment(dataEmissaoInicialDisplay).format('YYYY-MM-DD');

            var dataEmissaoFinalDisplay = moment($('input#dataEmissaoFinal').val(), "DD/MM/YYYY");
            var dataEmissaoFinal = moment(dataEmissaoFinalDisplay).format('YYYY-MM-DD');

            var dataInicialDisplay = moment($('input#dataInicial').val(), "DD/MM/YYYY");
            var dataInicial = moment(dataInicialDisplay).format('YYYY-MM-DD');

            var dataFinalDisplay = moment($('input#dataFinal').val(), "DD/MM/YYYY");
            var dataFinal = moment(dataFinalDisplay).format('YYYY-MM-DD');

            var descricao = $('#descricao').val();
            var pessoaId = $("#pessoaId").val();
            var formaPagamentoId = $("#formaPagamentoId").val();
            var condicaoParcelamentoId = $("#condicaoParcelamentoId").val();
            var categoriaId = $("#categoriaId").val();            

            var tipoUrl = "@Url.Action("Imprimir")";
            var url = tipoUrl+'?dataInicial=' + dataInicial +
                "&dataFinal=" + dataFinal +
                "&dataEmissaoInicial=" + dataEmissaoInicial +
                "&dataEmissaoFinal=" + dataEmissaoFinal +
                "&pessoaId=" + pessoaId +
                "&formaPagamentoId=" + formaPagamentoId +
                "&condicaoParcelamentoId=" + condicaoParcelamentoId +
                "&categoriaId=" + categoriaId +
                "&descricao=" + descricao;

            $$$.loading.start();
            $.ajax({
                url: '@Url.Action("ValidaImpressao")?dataInicial=' + dataInicial +
                "&dataFinal=" + dataFinal +
                "&dataEmissaoInicial=" + dataEmissaoInicial +
                "&dataEmissaoFinal=" + dataEmissaoFinal +
                "&pessoaId=" + pessoaId +
                "&formaPagamentoId=" + formaPagamentoId +
                "&condicaoParcelamentoId=" + condicaoParcelamentoId +
                "&categoriaId=" + categoriaId +
                "&descricao=" + descricao,
                type: "GET",
                success: function (data) {
                    if (data.success && data.records > 0 ) {
                        $$$.loading.stop();
                        fnImprimir(url);
                    }
                    else {
                        $$$.loading.stop();
                        $$$.toast(data.message, 'error');
                    }
                },
            });


        }
    }
</script>