<script>
    function fnFormReadyOrdemVendaKit() {
        var emiteNotaFiscal = $('#emiteNotaFiscal').val() == "True";

        if (!emiteNotaFiscal) {
            $('#lblGrupoTribuarioPadraoField').hide();
            $('#grupoTributarioProdutoIdKitField').hide();
            $('#grupoTributarioServicoIdKitField').hide();
        }

        $('form#fly01mdlfrmOrdemVendaKit input#orcamentoPedidoId').val($('form#fly01frm input#id').val());
        $("form#fly01mdlfrmOrdemVendaKit input#adicionarProdutos").prop("checked", true);
        $("form#fly01mdlfrmOrdemVendaKit input#adicionarServicos").prop("checked", true);
        $("form#fly01mdlfrmOrdemVendaKit input#somarExistentes").prop("checked", true);

        fnOverrideSubmit();
    }

    function fnOverrideSubmit() {
        var myForm = "form#fly01mdlfrmOrdemVendaKit";

        $(myForm).off("submit");
        $(myForm).on("submit", function (e) {
            var that = $(myForm);

            if (!that.valid())
                return false;
            e.preventDefault();
            $$$.loading.start();
            var formData = that.serializeObject();
            $.ajax({
                type: that.attr("method"),
                contentType: 'application/json',
                dataType: 'json',
                url: that.attr("action"),
                data: JSON.stringify(formData),
                success: function (data) {
                    if (data.success) {
                        $$$.toast(data.message, "success");
                        $$$._.fly01mdlfrmOrdemVendaKit.close();
                        $$$._.dtOrdemVendaProdutos.refresh();
                        $$$._.dtOrdemVendaServicos.refresh();
                    } else {
                        $$$.loading.stop();
                        $$$.fn.submitErrorHandler(null, data.message);
                    }
                    $$$.loading.stop();
                },
                error: function error(jXHR, textStatus) {
                    $$$.toast(textStatus, "error");
                    $$$.loading.stop();
                }
            });
        });
    }
</script>