<script>
    function fnSalvarRecorrencia() {
        if (($('#repeticaoPai').val() == 'true') || ($('#repeticaoFilha').val() == 'true'))
            fnModalEditarRecorrencia();
        else {
            if ($("form#fly01frmContaReceber").valid()) {
                $("form#fly01frmContaReceber").submit();
            }
        }
    };

    function fnModalEditarRecorrencia() {
        var modalId = `modalEditarRecorrencias`;

        if ($(`#${modalId}`).length > 0)
            $(`#${modalId}`).remove();

        var customConfirm = (title, message, confirmedFunction) => {
            var modal;
            modal = createElem("div", { "id": modalId, "class": "modal" }, [
                createElem("div", { "class": "modal-header" }, [
                    createElem("h5", null, title),
                    createElem("a", { "class": "modal-action modal-close" }, [
                        createElem("i", { "class": "material-icons" }, "close")
                    ])
                ]),
                createElem("div", { "class": "modal-content", "id": "deleteMessage" }, [
                    createElem("h6", null, message),
                    createElem("div", { "class": "input-field col s12 l12" }, [
                        createElem("input", { "id": "editarRecorrencias", "type": "checkbox", "name": "editarRecorrencias" }, message),
                        createElem("label", { "for": "editarRecorrencias" }, "Editar todas as recorrencias seguintes. As datas de vencimento/emissão não serão propagadas para as outras recorrencias.")
                    ])
                ]),
                createElem("div", { "class": "modal-footer" }, [
                    createElem("a", { "class": "modal-action modal-close btn" }, "CANCELAR"),
                    createElem("a", { "class": "modal-action modal-close modal-action-default btn", "onclick": confirmedFunction }, "CONTINUAR")
                ])
            ]);

            $("main").append(modal);
            $(".modal").modal();
            $(`#${modalId}`).modal("open");
        }
        customConfirm("Confirmar Edição", "Registro está vinculado a uma recorrência. Deseja realmente editar este registro?", "fnSalvarRecorrenciasConfirmed(\"" + $('#id').val() + "\")");
    }

    function fnSalvarRecorrenciasConfirmed(idRecord) {

        var that = $('form#fly01frmContaReceber');
        var action = that.attr("action");
        var formData = that.serialize();

        $('body').removeClass('loaded');
        if (idRecord) {
            $.ajax({
                type: "POST",
                url: "@Url.Action("Edit")?editarRecorrencias=" + ($("#editarRecorrencias:checked").length === 1),
                data: formData,
                success: function (data) {
                    $('body').addClass('loaded');
                    if (data.success) {
                        fly01.toast("Editado com sucesso.", "success");
                        var dtId = $("input[value=\"" + idRecord + "\"]").closest('table').attr('id');
                        fly01.go("@Url.Action("List", "ContaReceber")");
                    }
                    else {
                        fly01.fn.submitErrorHandler(null, data.message);
                    }
                },
                error: function (jXHR, textStatus, errorThrown) {
                    $('body').addClass('loaded');
                    fly01.toast(textStatus, "error");
                }
            });
        }
        fly01.fn.updateTextFields();
    }
</script>