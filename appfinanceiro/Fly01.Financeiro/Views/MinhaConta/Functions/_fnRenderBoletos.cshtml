<script>
    function fnRenderBoletos(data, type, row, meta) {      
        var btns = [
            createElem("a", { "alt": "Imprimir boleto", "target": "_blank", "href": row.urlBoleto, "class": "btn btn-narrow valid" }, createElem("i", { "class": "material-icons" }, "print"))
        ];
        if (row.boletoVencido && row.situacao == 'PENDENTE') {
            btns.push(createElem("a", { "alt": "2ª via", "target": "_blank", "href": row.urlSegundaVia, "class": "btn btn-narrow valid" }, createElem("i", { "class": "material-icons" }, "filter_2")))
        }
        if (row.situacao == "PENDENTE") {
            let btn = document.getElementById(`${row.id}cbbtn`);
            if (!btn) {
                btns.push(createElem("button", { "id": `${row.id}cbbtn`, "alt": "Copiar código", "class": "btn btn-narrow valid hide ajax" }, createElem("i", { "class": "material-icons" }, "file_copy")))
            }

            //o render é executado em cada cell do grid..
            //para não disparar inúmeras vezes
            if (btn && btn.classList.contains("ajax")) {
                btn.classList.remove("ajax");
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("CodigoBarras", "MinhaConta")",
                    data: { urlBoleto: row.urlBoleto, id: row.id },
                    success: function (json) {
                        if (json.success && json.codigoBarrasFormatado != "" && json.codigoBarrasFormatado != undefined) {
                            var btnCodigo = document.getElementById(`${json.id}cbbtn`);
                            if (!btnCodigo.classList.contains("done")) {
                                //tudo por que onclick não funcionou
                                $(`#divAcoes${json.id} #${json.id}cbbtn`).remove();
                                $(`#divAcoes${json.id}`).append(createElem("buttom", { "id": `${json.id}cbbtn`, "alt": "Copiar código", "onClick": "fnCopiarCodigoBarra(" + "'" + json.codigoBarrasFormatado + "'" + ")", "class": "btn btn-narrow valid done" }, createElem("i", { "class": "material-icons" }, "file_copy")));
                            }
                        }
                    }
                });
            }
        }
        return createElem("div", { "id": `divAcoes${row.id}`, "class": `right col s12` }, btns).outerHTML;
    };

    function fnCopiarCodigoBarra(codigoBarras) {
        const selBox = document.createElement('textarea');
        selBox.style.height = '0px';
        selBox.style.left = '-100px';
        selBox.style.opacity = '0';
        selBox.style.position = 'fixed';
        selBox.style.top = '-100px';
        selBox.style.width = '0px';
        selBox.textContent = codigoBarras;
        selBox.value = codigoBarras;
        document.body.appendChild(selBox);
        selBox.select();
        if (document.execCommand('copy')) {
            $$$.toast("Copiado com sucesso.", "success");
        }
        document.body.removeChild(selBox);
    }

</script>