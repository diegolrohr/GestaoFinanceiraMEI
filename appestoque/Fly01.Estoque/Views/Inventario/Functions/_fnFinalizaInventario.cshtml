<script>
    function fnFinalizaInventario(){
        var idRecord = $("input[type=hidden]#id").val();

        if (idRecord.length == 0) {
            $$$.toast("É necessário salvar o inventário antes de finaliza-lo", 'warning');
            return;
        }

        $$$._.dtInventarioItem.refresh();

        var dtData = $$$._.dtInventarioItem.data();

        if (!dtData || dtData.length == 0) {
            $$$.toast("Não é possivel salvar um inventário sem produtos.", 'warning');
            return;
        }

        $$$.confirm("Confirmar Finalização", "Deseja realmente finalizar este inventário?", "fnFinalizaInventarioConfirmed(\"" + idRecord + "\")");
    }

    function fnFinalizaInventarioConfirmed(id) {
        var myForm = "form#fly01frmInventario"

        var that = $(myForm);

        var action = that.attr("action");

        var formData = that.serializeObject();

        formData.inventarioStatus = "Finalizado";

        $('body').removeClass('loaded');
        if (id) {
            $.ajax({
                type: "POST",
                url: action,
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify(formData),
                success: function (data) {
                    $('body').addClass('loaded');
                    if (data.success) {
                        $$$.toast("Inventário finalizado com sucesso", "success");

                        $$$.go("@Url.Action("List", "Inventario")");
                    }
                    else {
                        $$$.loading.stop();
                        $$$.fn.submitErrorHandler(null, data.message);
                    }
                },
                error: function (jXHR, textStatus, errorThrown) {
                    $('body').addClass('loaded');
                    $$$.toast(textStatus, "error");
                }
            });
        }
    }
</script>