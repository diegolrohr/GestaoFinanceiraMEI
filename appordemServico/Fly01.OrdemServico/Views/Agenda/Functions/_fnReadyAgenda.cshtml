<script>
    function fnReadyAgenda() {
        document.getElementById("legenda").innerHTML =
            createElem("div", null, [
                createElem("span", { "class": "gray badge cool" }, "EM PREENCHIMENTO"),
                createElem("span", { "class": "totvs-blue badge cool" }, "EM ABERTO"),
                createElem("span", { "class": "light-orange badge cool" }, "EM ANDAMENTO"),
                createElem("span", { "class": "green badge cool" }, "CONCLUÍDO"),
                createElem("span", { "class": "red badge cool" }, "CANCELADO")
            ]).innerHTML;

        $('.fc-month-button').hide();
        $('.fc-agendaWeek-button').hide();
        $('.fc-agendaDay-button').hide();
        $$$.loading.start();
        var dataInicio = $($('.fc-day').get(0)).data("date")
        var dataFim = $($('.fc-day').get(-1)).data("date")
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetOSAgenda", "Agenda")',
            data: {
                dataInicial: dataInicio,
                dataFinal: dataFim
            },
            success: function (json, success) {
                if (success) {
                    fullCalendar(json);
                    $$$.loading.stop();
                }
                else
                    $$$.toast(response.message, 'error');
            }
        });

        $('.fc-next-button').on("click", function () {
            $$$.loading.start();
            var dataInicio = $($('.fc-day').get(0)).data("date")
            var dataFim = $($('.fc-day').get(-1)).data("date")
            $.ajax({
                type: "GET",
                url: '@Url.Action("GetOSAgenda", "Agenda")',
                data: {
                    dataInicial: dataInicio,
                    dataFinal: dataFim
                },
                success: function (json, success) {
                    if (success) {
                        fullCalendar(json);
                        $$$.loading.stop();
                    }
                    else
                        $$$.toast(response.message, 'error');
                }
            });
        });

        $('.fc-prev-button').click(function () {
            $$$.loading.start();
            var dataInicio = $($('.fc-day').get(0)).data("date")
            var dataFim = $($('.fc-day').get(-1)).data("date")
            $.ajax({
                type: "GET",
                url: '@Url.Action("GetOSAgenda", "Agenda")',
                data: {
                    dataInicial: dataInicio,
                    dataFinal: dataFim
                },
                success: function (json, success) {
                    if (success) {
                        fullCalendar(json);
                        $$$.loading.stop();
                    }
                    else
                        $$$.toast(response.message, 'error');
                }
            });
        });
      
        function fullCalendar(json) {
            for (var i = 0; i < json.response.length; i++) {
                $('#calendar').fullCalendar('renderEvent', {
                    eventLimit: true,
                    title: json.response[i].Cliente,
                    start: json.response[i].Entrega,
                    end: json.response[i].Entrega,
                    color: getColor(json.response[i].Status),
                    allDay: true,
                    editable: false,
                    url: json.response[i].Status == "Concluido" || json.response[i].Status == "Cancelado" ? "" : "OrdemServico/Edit/" + json.response[i].OSId
                });
            }
        }
        function getColor(status) {
            switch (status) {

                case "EmPreenchimento":
                    return "#8e999b";
                    break;

                case "EmAberto":
                    return "#0c9abe";
                    break;

                case "EmAndamento":
                    return "#FAA634";
                    break;

                case "Concluido":
                    return "#00b279";
                    break;

                case "Cancelado":
                    return "#db3a34";
                    break;

                default:
                    return "pink"
            }
        }
    }
</script>