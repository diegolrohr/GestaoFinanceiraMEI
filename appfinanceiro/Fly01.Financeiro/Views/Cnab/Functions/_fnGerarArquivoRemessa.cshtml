<script>
    @Html.Partial("Functions/_fnMain");

    function fnConfirmGeracaoArquivo(ids) {
        window.location = '@Url.Action("DownloadArquivoRemessa", "ArquivoRemessa")?ids=' + ids;
    };

    function fnGerarArquivoRemessa() {
        $("#dtBoletos").loading("start");
        $.ajax({
            type: "POST",
            url: '@Url.Action("GetQtdArquivos", "ArquivoRemessa")',
            data: { ids: $$$._.dtBoletos.selected },
            success: function (retorno) {
                if (retorno.success)
                {
                    var files = retorno.FileGuid;
                    if (files > 1)
                        $$$.confirm("Confirmar Geração de arquivo", "Existem diferentes bancos selecionados para geração do arquivo! Isto acarretará na geração de varios arquivos de remessa de acordo com os bancos selecionados. Deseja Continuar?", "fnConfirmGeracaoArquivo('" + $$$._.dtBoletos.selected + "')");
                    else {
                        window.location = '@Url.Action("DownloadArquivoRemessa", "ArquivoRemessa")?ids=' + $$$._.dtBoletos.selected;
                    }
                }
                else
                    $$$.toast(retorno.message, 'error');

                setTimeout(function () {
                    $$$._.dtBoletos.refresh();
                    $("#dtBoletos").loading("stop");
                }, 5000);
            }
        });
    };
</script>