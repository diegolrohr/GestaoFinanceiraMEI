<script>
    function fnRenderSugestao(data, type, row, meta) {
        if (row.conciliacaoBancariaItemContasFinanceiras != null && row.conciliacaoBancariaItemContasFinanceiras.length) {
            var selectElement = createElem("div", { "id": "contaFinanceiraIdField", "class": "input-field visible col s12" }, [
              createElem("select", { "class": "", "id": "contaFinanceiraId", "name": "contaFinanceiraId" }, row.conciliacaoBancariaItemContasFinanceiras.reduce(function (prev, curr) {
                  var optAttr = { "value": curr.contaFinanceiraId || "" };
                  if (curr.selected) optAttr.selected = "selected";
                  var optLabel = (curr.contaFinanceira.descricao || "") + " (" + curr.contaFinanceira.dataVencimento + ")";

                  return prev.concat(createElem("option", optAttr, optLabel));
              }, [createElem("option", { "value": "" }, "")])),
              createElem("label", { "class": "truncate", "for": "contaFinanceiraId" }, "Sugestões")
            ]);

            var submitButton = createElem("button", { "type": "submit", "class": "btn btn-flat btn-narrow", "id": "" },
              createElem("i", { "class": "material-icons" }, "done")
            );

            var form = createElem("form", { "method": "POST", "action": "@Url.Action("SalvarConciliacaoBancariaItemConta")", "class": "sugestao valign-wrapper right col s12" }, [
              createElem("input", { "type": "hidden", "id": "conciliacaoBancariaItemId", "name": "conciliacaoBancariaItemId", "value": row.id }),
              createElem("input", { "type": "hidden", "id": "valorConciliado", "name": "valorConciliado", "value": row.valorFormat2 }),
              selectElement,
              submitButton
            ]);

            return form.outerHTML;
        }
        else {
            return "";
        }
    }
    $(document).off("submit", "form.sugestao");
    $(document).on("submit", "form.sugestao", function (e) {
        var that = $(this);
        that.loading("start");
        e.preventDefault();
        if (!that.valid()) {
            that.loading("stop");
            return false;
        }
        else {
            $.ajax({
                url: that.attr("action"),
                type: "POST",
                data: that.serialize(),
                success: function success(data) {
                    if (data.success) {
                        var strMsg = "Sugestão vinculada com sucesso.";
                        if (data.message !== "")
                            strMsg = data.message;
                        $$$.toast(strMsg, "success");
                        that.loading("stop");
                        $$$._.dtConciliacaoItens.refresh();
                    } else {
                        $$$.toast(data.message, "error");
                    }
                    that.loading("stop");
                },
                error: function error(jXHR, textStatus) {
                    $$$.toast(textStatus, "error");
                    that.loading("stop");
                }
            });
        }
    });    
</script>