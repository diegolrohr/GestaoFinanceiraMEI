<script>
    @Html.Partial("Functions/_fnMain");

    function kitItensShow() {
        $('#dtConfig').show();
        $('#fly01frmKitItens').show();
    }

    function fndtHide() {
        $('#dtConfig').hide();
        $('#fly01frmKitItens').hide();        
    }

    function fnOverrideSubmit() {
        var myForm = "form#fly01frmKit";

        $(myForm).off("submit");
        $(myForm).on("submit", function (e) {
            var that = $(myForm);

            if (!that.valid())
                return false;
            e.preventDefault();
            $$$.loading.start();
            var formData = that.serializeObject();
            $.ajax({
                type: that.attr("method"),
                contentType: 'application/json',
                dataType: 'json',
                url: that.attr("action"),
                data: JSON.stringify(formData),
                success: function (data) {
                    if (data.success) {
                        $$$.toast(data.message, "success");

                        $$$.go("@Url.Action("Form", "Kit")", data.id);
                    } else {
                        $$$.loading.stop();
                        $$$.fn.submitErrorHandler(null, data.message);
                    }
                    $$$.loading.stop();
                },
                error: function error(jXHR, textStatus) {
                    $$$.toast(textStatus, "error");
                    $$$.loading.stop();
                }
            });
        });
    }

    function changeSaveButton() {
        var buttonCancel = $('ul.fly01-buttons').children().slice(1).find('#cancel');

        var cancelFunction = buttonCancel.attr('onclick');

        var btnSalvar = $('ul.fly01-buttons').children().find('#save');

        btnSalvar.attr('id', buttonCancel.attr('id'));
        btnSalvar.attr('onclick', cancelFunction);
        btnSalvar.html(buttonCancel.html());
    }

    //function fnkitFechado() {
    //    if ($('input#inventarioStatus').val() !== "Finalizado")
    //        return;

    //    $('form#fly01frmInventario').find('input').attr('disabled', 'disabled');

    //    changeSaveButton();

    //    $('ul.fly01-buttons').children().slice(1).hide();
    //};

    function isCreate() {
        var idSelector = "input#id";
        var id = $(idSelector).val();

        if (id.length === 0)
            return true;

        return false;
    };

    function fnFormReady() {
        $('#Field').hide();
        if (isCreate()) {
            fnOverrideSubmit();
            fndtHide();
        } else {
            kitItensShow();
            $$$._.dtConfig.refresh();
            //fnkitFechado();
        }
    }

</script>
