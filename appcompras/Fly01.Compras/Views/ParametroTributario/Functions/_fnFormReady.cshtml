<script>
    @Html.Partial("Functions/_fnMain");

    function fnFormReady() {
        $$$.loading.start();
        $.ajax({
            url: '@Url.Action("CarregaParametro", "ParametroTributario")',
            type: "GET",
            success: function (data) {
                $("input#id").val(data.id);
                $("input#aliquotaSimplesNacional").val(data.aliquotaSimplesNacional);
                $("input#aliquotaFCP").val(data.aliquotaFCP);
                $("input#aliquotaISS").val(data.aliquotaISS);
                $("input#aliquotaPISPASEP").val(data.aliquotaPISPASEP);
                $("input#aliquotaCOFINS").val(data.aliquotaCOFINS);
                $("input#numeroRetornoNF").val(data.numeroRetornoNF);
                $("#mensagemPadraoNota").val(data.mensagemPadraoNota);
                $('select#tipoModalidade').val(data.tipoModalidade);
                $('select#tipoModalidade').material_select();
                $('select#tipoVersaoNFe').val(data.tipoVersaoNFe);
                $('select#tipoVersaoNFe').material_select();
                $('select#tipoAmbiente').val(data.tipoAmbiente);
                $('select#tipoAmbiente').material_select();
                $('select#tipoPresencaComprador').val(data.tipoPresencaComprador);
                $('select#tipoPresencaComprador').material_select();
                $('select#horarioVerao').val(data.horarioVerao);
                $('select#horarioVerao').material_select();
                $('select#tipoHorario').val(data.tipoHorario);
                $('select#tipoHorario').material_select();
                $('#versaoNFSe').val(data.versaoNFSe);
                $('#usuarioWebServer').val(data.usuarioWebServer);
                $('#senhaWebServer').val(data.senhaWebServer);
                $('#chaveAutenticacao').val(data.chaveAutenticacao);
                $('#autorizacao').val(data.autorizacao);
                $('#tipoTributacaoNFS').val(data.tipoTributacaoNFS);
                $('select#tipoTributacaoNFS').material_select();
                $('#tipoAmbienteNFS').val(data.tipoAmbienteNFS);
                $('select#tipoAmbienteNFS').material_select();
                $("input#aliquotaCSLL").val(data.aliquotaCSLL);
                $("input#aliquotaINSS").val(data.aliquotaINSS);
                $("input#aliquotaImpostoRenda").val(data.aliquotaImpostoRenda);
                $("input#incentivoCultura").prop("checked", data.incentivoCultura);
                $("input#formatarCodigoISS").prop("checked", data.formatarCodigoISS);
                $('#tipoRegimeEspecialTributacao').val(data.tipoRegimeEspecialTributacao);
                $('select#tipoRegimeEspecialTributacao').material_select();
                $('#tipoCRT').val(data.tipoCRT);
                $('select#tipoCRT').material_select();
                $$$.fn.updateTextFields();
                $$$.loading.stop();
            },
            error: function (jXHR, textStatus, errorThrown) {
                $$$.loading.stop();
                $$$.toast(data.message, 'error');
            }
        });

        setNFERequiredFields("fly01frm", ["aliquotaSimplesNacional", "aliquotaFCP", ]);
        setNFSERequiredFields("fly01frm", ["aliquotaISS", "aliquotaCSLL", "aliquotaINSS", "aliquotaImpostoRenda"]);
        setNFEAndNFSERequiredFields("fly01frm", ["aliquotaPISPASEP", "aliquotaCOFINS"]);
        verificaParametrosTributarios();
    }

    function verificaParametrosTributarios() {
        var url = '@Url.Action("ExisteParametroSalvo", "EmpresaAtualizaIE")';
        $.ajax({
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            type: 'GET',
            url: url,
            success: function success(data) {
                if (!data.existeParametro) {
                    $$$.modal("@Url.Action("FormModal", "AliquotaSimplesNacional", new { isOnCadastroParametros = "true" })");
                }
            },
            error: function error(jXHR, textStatus) {
                $$$.toast(textStatus, "error");
                $$$.loading.stop();
            }
        });
    }
</script>