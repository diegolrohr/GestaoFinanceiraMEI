<script>
    @Html.Partial("Functions/_fnMain");

    function fnConfirmGeracaoArquivo(files, ids) {
        window.location = '@Url.Action("DownloadArquivoRemessa", "ArquivoRemessa")?files=' + files + "&ids=" + ids;
    };

    function fnGerarArquivoRemessa() {
        $("#dtBoletos").loading("start");
        $.ajax({
            type: "POST",
            url: '@Url.Action("GeraArquivoRemessa", "ArquivoRemessa")',
            data: { ids: fly01._.dtBoletos.selected },
            success: function (retorno) {
                if (retorno.success)
                {
                    var files = retorno.FileGuid;
                    if (files.length > 1)
                        fly01.confirm("Confirmar Geração de arquivo", "Existem diferentes bancos selecionados para geração do arquivo! Isto acarretará na geração de varios arquivos de remessa de acordo com os bancos selecionados. Deseja Continuar?", "fnConfirmGeracaoArquivo('" + files + "','" + fly01._.dtBoletos.selected + "')");
                    else {
                        window.location = '@Url.Action("DownloadArquivoRemessa", "ArquivoRemessa")?files=' + files + "&ids=" + fly01._.dtBoletos.selected;
                    }
                }
                else
                    fly01.toast(retorno.message, 'error');

                setTimeout(function () {
                    fly01._.dtBoletos.refresh();
                    $("#dtBoletos").loading("stop");
                }, 5000);
            }
        });
    };
</script>